<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        .chat-container {
            width: 60%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
        }
        .chat-messages {
            height: 300px;
            overflow-y: auto;
            padding: 10px;
            border-bottom: 1px solid gray;
        }
        .message {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .message img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            cursor: pointer;
        }
        .admin-dropdown {
            display: none;
            position: absolute;
            background: #333;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
        .input-container {
            display: flex;
            margin-top: 10px;
        }
        .input-container textarea {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        .input-container button {
            margin-left: 10px;
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <h2>Global Chat</h2>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="input-container">
            <textarea id="chatInput" placeholder="Type a message..."></textarea>
            <button id="sendMessage">Send</button>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, getDoc, doc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        
        const firebaseConfig = {
      apiKey: "AIzaSyBMUi291fwb-HSxlGPQMxdEJGUTiOOvFBs",
      authDomain: "nexaverse-eeb07.firebaseapp.com",
      projectId: "nexaverse-eeb07",
      storageBucket: "nexaverse-eeb07.appspot.com",
      messagingSenderId: "686342300627",
      appId: "1:686342300627:web:90522d8f1129fb00b08526",
    }; // Your config
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const chatMessages = document.getElementById("chatMessages");
        const chatInput = document.getElementById("chatInput");
        const sendMessage = document.getElementById("sendMessage");

        function loadChat() {
            const chatQuery = query(collection(db, "globalChat"), orderBy("timestamp", "asc"));
            onSnapshot(chatQuery, (snapshot) => {
                chatMessages.innerHTML = "";
                snapshot.forEach(docSnap => {
                    const data = docSnap.data();
                    const messageEl = document.createElement("div");
                    messageEl.className = "message";
                    messageEl.innerHTML = `
                        <img src="${data.profilePic || 'default-avatar.png'}" alt="Avatar" onclick="showAdminOptions('${docSnap.id}', '${data.username}')">
                        <strong>${data.username}</strong>: ${data.text.replace(/\n/g, '<br>')}
                        <div id="admin-${docSnap.id}" class="admin-dropdown">
                            <button onclick="deleteMessage('${docSnap.id}')">Delete Message</button>
                            <button onclick="disableAccount('${data.userId}')">Disable Account</button>
                        </div>
                    `;
                    chatMessages.appendChild(messageEl);
                });
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }
        loadChat();

        sendMessage.addEventListener("click", async () => {
            const text = chatInput.value.trim();
            if (!text) return;
            const user = auth.currentUser;
            if (!user) return alert("You must be logged in!");
            const userDocSnap = await getDoc(doc(db, "users", user.uid));
            if (!userDocSnap.exists()) return alert("User not found!");
            await addDoc(collection(db, "globalChat"), {
                text,
                profilePic: userDocSnap.data().pfp,
                username: userDocSnap.data().name,
                userId: user.uid,
                timestamp: new Date()
            });
            chatInput.value = "";
        });

        window.showAdminOptions = (messageId, username) => {
            const dropdown = document.getElementById(`admin-${messageId}`);
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        };

        window.deleteMessage = async (messageId) => {
            // Admin message deletion logic here
            alert("Deleted message: " + messageId);
        };

        window.disableAccount = async (userId) => {
            // Admin disable account logic here
            alert("Disabled account: " + userId);
        };
    </script>
</body>
</html>
