<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile - DreamWeave</title>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #fff;
      font-family: 'Poppins', sans-serif;
      padding: 20px;
      text-align: center;
    }
    .profile-container {
      margin-bottom: 20px;
    }
    .profile-container img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
    }
    .profile-container h2 {
      margin: 10px 0;
    }
    .profile-container p {
      margin: 5px 0;
    }
    .posts-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .post-card {
      background: rgba(0,0,0,0.6);
      padding: 15px;
      border-radius: 10px;
      width: 300px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      text-align: left;
    }
    .post-card img {
      width: 100%;
      border-radius: 8px;
    }
    .post-card h3 { margin: 10px 0; }
  </style>
</head>
<body>
  <div class="profile-container">
    <img id="profile-pic" src="default-avatar.png" alt="Profile Picture">
    <h2 id="username">Username</h2>
    <p><strong>Role:</strong> <span id="role"></span></p>
    <p><strong>Member Since:</strong> <span id="created-date"></span></p>
  </div>
  <h2>Your Posts</h2>
  <div class="posts-container" id="user-posts"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBMUi291fwb-HSxlGPQMxdEJGUTiOOvFBs",
      authDomain: "nexaverse-eeb07.firebaseapp.com",
      projectId: "nexaverse-eeb07",
      storageBucket: "nexaverse-eeb07.appspot.com",
      messagingSenderId: "686342300627",
      appId: "1:686342300627:web:90522d8f1129fb00b08526",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Get user id from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get("id");

    async function loadUserProfile() {
      if (!userId) {
        document.body.innerHTML = "<h2>User not found</h2>";
        return;
      }
      const userDoc = await getDoc(doc(db, "users", userId));
      if (userDoc.exists()) {
        const userData = userDoc.data();
        document.getElementById("profile-pic").src = userData.profilePicture || "default-avatar.png";
        document.getElementById("username").textContent = userData.username;
        document.getElementById("role").textContent = userData.role;
        if (userData.createdAt) {
          document.getElementById("created-date").textContent = new Date(userData.createdAt.toDate()).toLocaleDateString();
        }
      } else {
        document.body.innerHTML = "<h2>User not found</h2>";
      }
    }

    async function loadUserPosts() {
      const postsContainer = document.getElementById("user-posts");
      const q = query(collection(db, "posts"), where("userId", "==", userId), orderBy("timestamp", "desc"));
      const querySnapshot = await getDocs(q);
      postsContainer.innerHTML = "";
      querySnapshot.forEach(docSnap => {
        const post = docSnap.data();
        postsContainer.innerHTML += `
          <div class="post-card">
            <img src="${post.thumbnail}" alt="${post.title}">
            <h3>${post.title}</h3>
            <p>${post.description}</p>
            <a href="${post.link}" target="_blank">View</a>
          </div>
        `;
      });
    }

    loadUserProfile();
    loadUserPosts();
  </script>
</body>
</html>
